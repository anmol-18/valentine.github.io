<div class="page">
  <div class="floaties" aria-hidden="true">
    @for (f of floaties; track $index) {
      <span
        class="floaty"
        [style.left.%]="f.leftPct"
        [style.width.px]="f.sizePx"
        [style.height.px]="f.sizePx"
        [style.animationDuration.s]="f.durationS"
        [style.animationDelay.s]="f.delayS"
        [style.opacity]="f.opacity"
      ></span>
    }
  </div>

  <main class="shell">
    <header class="topbar">
      <div class="brand" aria-label="Valentine app">
        <span class="brand__icon" aria-hidden="true">ğŸ’›</span>
        <span class="brand__text">Our little Valentine story</span>
      </div>

      @if (slide() !== 'gate') {
        <button class="btn btn--ghost" type="button" (click)="back()">
          â† Back
        </button>
      }
    </header>

    <section class="scene" aria-live="polite">
      <svg class="decor decor--sunflower" viewBox="0 0 256 256" aria-hidden="true">
        <g fill="none">
          <path
            fill="#FFD36A"
            d="M128 12c9 0 17 36 26 39s44-14 50-8 2 42 8 50 42 2 50 8-11 41-8 50 39 17 39 26-36 17-39 26 14 44 8 50-42 2-50 8-2 42-8 50-41-11-50-8-17 39-26 39-17-36-26-39-44 14-50 8-2-42-8-50-42-2-50-8 11-41 8-50-39-17-39-26 36-17 39-26-14-44-8-50 42-2 50-8 2-42 8-50 41 11 50 8 17-39 26-39Z"
            opacity=".92"
          />
          <circle cx="128" cy="128" r="64" fill="#F7A43B" />
          <circle cx="128" cy="128" r="36" fill="#502A1B" opacity=".95" />
          <circle cx="112" cy="112" r="10" fill="#FFF6D7" opacity=".6" />
        </g>
      </svg>

      <svg class="decor decor--rose" viewBox="0 0 256 256" aria-hidden="true">
        <g fill="none">
          <path
            fill="#FF6AA2"
            d="M128 232c-5.7 0-11.3-2.2-15.4-6.3L44.6 157.7c-26.4-26.4-26.4-69.1 0-95.5 25.5-25.5 66.2-26.4 92.8-2.7 26.6-23.7 67.3-22.8 92.8 2.7 26.4 26.4 26.4 69.1 0 95.5l-68 68c-4.1 4.1-9.7 6.3-15.4 6.3Z"
            opacity=".25"
          />
          <path
            fill="#D61B5E"
            d="M128 216c-2.7 0-5.3-1-7.3-3.1l-62.4-62.4c-20.4-20.4-20.4-53.5 0-73.9 19.9-19.9 51.5-20.4 72-2.3 20.5-18.1 52.1-17.6 72 2.3 20.4 20.4 20.4 53.5 0 73.9l-62.4 62.4c-2 2-4.6 3.1-7.3 3.1Z"
          />
          <path
            fill="#FFF1F6"
            d="M92 88c6-10 20-16 34-12 1.6.5 2.4 2.3 1.6 3.8-5.4 10.6-20.4 16.2-34 12.1-1.7-.5-2.4-2.3-1.6-3.9Z"
            opacity=".55"
          />
        </g>
      </svg>

      @if (slide() === 'gate') {
        <div class="slide slide--center">
          <p class="kicker">A tiny secret doorway</p>
          <h1 class="title" data-testid="gate-title">Type your name to unlock our memories</h1>
          <p class="subtitle">
            (Only one name works. No pressure. Justâ€¦ be you.)
          </p>

          <div class="gate">
            <label class="field">
              <span class="field__label">Name</span>
              <input
                class="field__input"
                [value]="enteredName()"
                (input)="enteredName.set(($any($event.target).value ?? ''))"
                (keydown.enter)="start()"
                placeholder="e.g. Ananya"
                autocomplete="off"
              />
            </label>

            <button class="btn btn--primary" type="button" (click)="start()">
              Unlock âœ¨
            </button>
          </div>

          @if (gateError()) {
            <p class="error" role="alert">{{ gateError() }}</p>
          }

          <p class="hint">
            Tip: update the real name inside <code>src/app/app.ts</code>.
          </p>
        </div>
      }

      @if (slide() === 'memory-1' || slide() === 'memory-2' || slide() === 'memory-3') {
        @let idx = slide() === 'memory-1' ? 0 : (slide() === 'memory-2' ? 1 : 2);
        @let m = memories[idx];

        <div class="slide">
          <div class="memory">
            <div class="memory__imageWrap">
              <img class="memory__image" [src]="m.imageSrc" [alt]="m.title" loading="eager" />
              <div class="memory__badge">ğŸ’•</div>
            </div>

            <div class="memory__text">
              <p class="kicker">Memory {{ idx + 1 }} of 3</p>
              <h2 class="title title--sm">{{ m.title }}</h2>
              <p class="subtitle subtitle--sm">{{ m.subtitle }}</p>

              <p class="paragraph">
                {{ m.paragraph }}
              </p>

              <div class="actions">
                <div class="dots" aria-label="Memory progress">
                  <span class="dot" [class.dot--active]="idx === 0"></span>
                  <span class="dot" [class.dot--active]="idx === 1"></span>
                  <span class="dot" [class.dot--active]="idx === 2"></span>
                </div>

                <button class="btn btn--primary" type="button" (click)="nextMemory()">
                  {{ idx === 2 ? 'One more thingâ€¦' : 'More memories â†’' }}
                </button>
              </div>
            </div>
          </div>
        </div>
      }

      @if (slide() === 'ask') {
        <div class="slide slide--center">
          <p class="kicker">Okayâ€¦ deep breath</p>
          <h1 class="title">Will you be my Valentine, {{ displayName() }}?</h1>
          <p class="subtitle">
            I promise: flowers, laughs, and a day that feels like a warm hug.
          </p>

          <div
            class="askArena"
            #arena
            (pointerleave)="resetNoPosition()"
          >
            <button class="btn btn--yes" type="button" (click)="sayYes()">
              Yes ğŸ’˜
            </button>

            <button
              class="btn btn--no"
              type="button"
              (pointerenter)="evadeNo(arena, $event)"
              (pointermove)="evadeNo(arena, $event)"
              (pointerdown)="evadeNo(arena, $event)"
              [style.left.px]="noBtnX()"
              [style.top.px]="noBtnY()"
            >
              No ğŸ™ˆ
            </button>
          </div>

          <p class="hint">
            (Try to click â€œNoâ€. I made it shy on purpose.)
          </p>
        </div>
      }

      @if (slide() === 'yes') {
        <div class="slide">
          <div class="yes">
            <div class="yes__left">
              <p class="kicker">She said yes?!</p>
              <h1 class="title title--sm">Yay. Itâ€™s a date.</h1>
              <p class="subtitle subtitle--sm">
                Hereâ€™s a little video for you, and then pick a time that feels perfect.
              </p>

              <div class="videoCard">
                <video class="video" [src]="videoSrc" controls playsinline></video>
                <p class="videoHint">
                  Put your video at <code>public/valentine-message.mp4</code>
                </p>
              </div>
            </div>

            <div class="yes__right">
              <div class="planner">
                <h2 class="planner__title">Choose our Valentine date</h2>

                <label class="field">
                  <span class="field__label">Date</span>
                  <input
                    class="field__input"
                    type="date"
                    [value]="chosenDate()"
                    (input)="chosenDate.set(($any($event.target).value ?? ''))"
                  />
                </label>

                <label class="field">
                  <span class="field__label">Time</span>
                  <input
                    class="field__input"
                    type="time"
                    [value]="chosenTime()"
                    (input)="chosenTime.set(($any($event.target).value ?? ''))"
                  />
                </label>

                <button class="btn btn--primary" type="button" (click)="confirmPlan()">
                  Confirm ğŸ’›
                </button>

                @if (confirmed()) {
                  <div class="confirm" role="status">
                    <p class="confirm__title">Locked in.</p>
                    <p class="confirm__text">
                      {{ displayName() }}, our Valentine plan is set for
                      <strong>{{ chosenDate() || 'a special day' }}</strong>
                      at
                      <strong>{{ chosenTime() || 'a perfect time' }}</strong>.
                    </p>
                    <p class="confirm__text">I love you. ğŸŒ»ğŸŒ¹</p>
                  </div>
                }
              </div>
            </div>
          </div>
        </div>
      }
    </section>

    <footer class="footer">
      <span class="footer__text">Made with love.</span>
    </footer>
  </main>
</div>
